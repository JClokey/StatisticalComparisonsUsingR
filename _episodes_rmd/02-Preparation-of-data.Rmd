---
title: "Preparation of Data"
teaching: 45
exercises: 10
questions:
- "How can I import a dataset into R?"
objectives:
- "Review the structure of a CSV datafile"
- "Read a CSV file into a dataframe"
- "Manage the assignment of data as factors or character strings"
keypoints:
- "Open a data file in a text editor or RStudio file viewer"
- "Use `read.table` or `read.csv` to import data"
- "Review a dataframe using `str` and `summary`"
- "Convert columns from factors to string using `as.character`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Previewing data

Prior to uploaded any dataset into R for analysis, it is useful to review the 
contents of that file to understand the structure of the data. This will allow
you to chose the best data structure for your dataset, and will identify the 
relevant command and settings you need when uploading the data to R. 

For small files, like the one we are using today, this review can be done with a
simple text editor, either a app on your computer or from within RStudio. For 
very large datasets this is not advisable - files may take a very long time to 
open and may even crash your computer. Such large files may have documentation 
explaining their format, or you may need to use the `head` function to look at 
just the first part of the file.

> ## Challenge 1
> 
> Use RStudio “Files” window, your text editor of choice, or a spreadsheet 
> program to open and review the data file gallstones.csv (do not overwrite 
> the file by saving afterwards). Briefly discuss with your neighbour the 
> meaning of the headers and the nature of the data in each field.
> > ## Solution to challenge 1
> > 
> > The field contents are as follows:
> > * Patient_ID – a unique numerical identifier for each patient
> > * Gender – female or male: one-letter character string
> > * Age – patient’s age: numerical value in years
> > * Height – patient’s height: numerical value in (probably) cm
> > * Weight – patient’s weight: numerical value in (probably) kg
> > * BMI – patient’s body mass index (weight/height in m<sup>2</sup>)
> > * Obese – is the patient obese (BMI>30): 0=no, 1=yes;
> > * Smoking.Status – does the patient smoke: 1=non-smoker, 2=smoker; 
> > * Alcohol.Consumption – does the patient drink alcohol: 0=no, 1=low consumption,
> > 2=moderate/high consumption; 
> > * Treatment – did the patient receive the ursodeoxycholic acid treatment: 
> > 0=untreated, 1=treated; 
> > * Rec – did gallstones recur: 0=no recurrence, 1=recurrence; 
> > * Mult – did the patient have multiple gallstones: 0=single stone, 1=multiple 
> > stones; 
> > * Diam – gallstone diameter in mm; 
> > * Dis – time in days for gallstone dissolution
> {: .solution}
{: .challenge}

## Importing data

Once you've reviewed the contents of the data file, you can decide how best to
upload it into R. In this case, we have a tabular layout with fields separated
by commas - a CSV file - so we will use the `read.csv` function to import this
dataset.

> ## Tip
When reading in tabular data in R, you can use either `read.table` or a range of 
pre-configured aliases: `read.csv`, `read.csv2`, `read.delim` and `read.delim2`.
These have function arguments already set to correspond to a range of different 
formats of CSV (comma separated value) and TSV (tab separated value) files.
{: .callout}


The default settings of `read.csv` are compatible with this datafile, so when
running the command, all we need to specify is the target filename
```{r}
gallstones <- read.csv("data/gallstones.csv")
```

Now the file is uploaded, you can find out more about this dataset using the `str`
and `summary` functions.
```{r}
str(gallstones)
summary(gallstones)
```

## Columns as factors

This shows, among other details, that the dataset consists of records from 37 
patients, aged 31 to 90, of whom 21 are female and 16 male. Looking further, you
may notice that patient identifier, which should be unique, has been imported 
as a factor - this is probably not the best option for a unique identifier so it 
would be best to convert this to character strings.

```{r}
gallstones$Patient_ID <- as.character(gallstones$Patient_ID)
str(gallstones$Patient_ID)
```

> ## Challenge 2
> 
> How could you have modified your `read.csv` command so that patient identifiers
> were imported as character strings in the first place? What other issues might
> this have caused?
> > ## Solution to challenge 2
> > 
> > You could use the `stringsAsFactors = FALSE` argument to `read.csv`. But this
> > would mean that Gender was also read in as character strings, and that is best
> > represented as a factor.
> {: .solution}
{: .challenge}
